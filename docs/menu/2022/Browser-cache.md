# 浏览器的缓存

浏览器缓存是浏览器再本地磁盘对用户最近请求过的文档进行存储，当重复访问时就可以使用本地缓存直接加载，而不用向浏览器重复请求，减少网页的加载速度，也减少了服务器的请求负担

## 强缓存和协商缓存

- 强缓存不需要向服务器请求数据，而是直接使用本地的缓存资源，`expires`字段表示缓存资源过期时间，如果在这个过期时间内，就使用强缓存；`cache-control`字段中的`max-age`字段也是代表缓存资源的过期时间，在这个时间段内都会使用强缓存。

- 强缓存分为`memory cache`---内存缓存和`disk cache`---硬盘缓存两种方式，内存缓存是指存储在内存中的缓存，存储空间有限，缓存时间短，读取时间快，在关闭页面时就会释放掉其中的缓存；硬盘缓存是指存储在硬盘中的缓存，容量大，缓存时间长，不会随页面关闭而清除缓存，但是读取时间比内存缓存稍长，两者都有各自的优势和缺点，浏览器会根据实际情况进行合理使用两者的缓存，使用该两种方式都比向服务器请求资源的时间更快

- 协商缓存的使用是因为如果服务器的资源已经更新了，那就需要同步更新本地的缓存资源，这样的情况下就需要进行协商缓存，即与服务器协商缓存的内容是否需要得到更新，则至少需要和服务器通信一次

  1、`Last-Modify/If-Modify-Since`字段，浏览器第一次请求一个资源的时候，服务器会在`header`中加上`Last-Modify`，即一个时间标识资源的最后修改时间，之后请求时会带上`If-Modify-Since`，其实就是服务器给的`Last-Modify`值，服务器通过该字段确定是否命中缓存

  2、`Etag/If-None-Match`字段，当资源过期时，发现资源具有`Etag`申明，则再次向服务器请求带上`If-None-Match`字段，即`Etag`值，服务器通过该值判断是否命中缓存

  注意：后者的优先级比前者更高，后者的精度也比前者高

## 浏览器的缓存流程

1、首次访问，没有缓存，向服务器请求数据，并做第一次的缓存(若配置了不做缓存就始终不缓存)

2、再次访问时，有强缓存且未失效，则不请求服务器，直接使用强缓存

3、强缓存失效，则使用协商缓存和服务器协商是否更新缓存，返回304不需要更新则继续使用强缓存，需要更新则把全新数据返回并返回200

## 一些web存储方案

1、`cookie` 一般用来存储服务器发送来的一小块数据，通常用于服务器识别用户，还可以记录一些会话状态管理，用户行为跟踪等

- 基础用法     `document.cookie`可进行获取和赋值

2、`localStorage`   一种持久化的存储方式，只要不主动清除就不会过期，采用键值对的方式存储

- 基础用法   `localStorage.setItem()`增加一个数据项

  ​                  `localStorage.getItem()`获取一个数据项

  ​                  `localStorage.removeItem()`删除一个数据项

3、`sessionStorage`  一种短暂存储的缓存，关闭浏览器时数据会被清除，也是采用键值对的方式存储

- 基础用法   `sessionStorage.setItem()`新增一个数据项

  ​                  `sessionStorage.getItem()`获取一个数据项

​                         `sessionStorage.removeItem()`删除一个数据项

4、`web SQL`  提供`api`接口来操作客户端数据库

- 基础用法   `openDatabase()`打开已有数据库或者创建新的数据库

  ​                  `transaction()`提供事务处理回调

  ​                 `executeSql()`用于执行`sql`语句

5、`indexedDB`  可以用于存储大量结构化的数据，包括文件、二进制大型对象，存储空间更大

- 基础用法  `indexedDB.open()`打开或者创建一个数据库

  ​                 `indexedDB.deleteDatabase()`删除数据库

  ​                 `add()`添加   `delete()`删除   `put()`更新  `clear()`清空  等操作...

:100: